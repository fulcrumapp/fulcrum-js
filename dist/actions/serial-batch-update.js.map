{"version":3,"sources":["../../src/actions/serial-batch-update.js"],"names":["SerialBatchUpdate","ids","attributes","changesetOptions","changesetObj","form_id","metadata","app","operation","client","changesets","create","changeset","updatedRecords","id","recordAttributes","changeset_id","options","body","attributesForObject","api","put","memberPath","push","resourceName","close","Mixin"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;;;IAEqBA,iB;;;;;;;;;;;2GACKC,G,EAAKC,U;YAAYC,gB,uEAAmB,E;;;;;;;;AAC1D;AACMC,4B,GAAe;AACnBC,2BAASH,WAAWG,OAAX,IAAsBF,iBAAiBE,OAD7B;AAEnBC,4BAAUH,iBAAiBG,QAAjB,IAA6B;AACrCC,yBAAK,YADgC;AAErCC,+BAAW;AAF0B;AAFpB,iB;;uBAQG,KAAKC,MAAL,CAAYC,UAAZ,CAAuBC,MAAvB,CAA8BP,YAA9B,C;;;AAAlBQ,yB;;;AAEN;AACMC,8B,GAAiB,E;;;;;4BAENZ,G;;;;;;;;AAANa,kB;AACHC,gC,8BACDb,U;AACHc,gCAAcJ,UAAUE;;AAGpBG,uB,GAAU;AACdC,wBAAM,KAAKC,mBAAL,CAAyBJ,gBAAzB;AADQ,iB;;uBAIG,KAAKN,MAAL,CAAYW,GAAZ,CAAgBC,GAAhB,CAAoB,KAAKC,UAAL,CAAgBR,EAAhB,CAApB,EAAyCG,OAAzC,C;;;AAAbC,oB;;AACNL,+BAAeU,IAAf,CAAoBL,KAAK,KAAKM,YAAV,CAApB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;uBAII,KAAKf,MAAL,CAAYC,UAAZ,CAAuBe,KAAvB,CAA6Bb,UAAUE,EAAvC,C;;;iDAECD,c;;;;;;;;;;;;;;;;;;EAjCoCa,kB;;kBAA1B1B,iB","file":"serial-batch-update.js","sourcesContent":["import Mixin from 'mixmatch';\n\nexport default class SerialBatchUpdate extends Mixin {\n  async serialBatchUpdate(ids, attributes, changesetOptions = {}) {\n    // Create a changeset for this bulk operation\n    const changesetObj = {\n      form_id: attributes.form_id || changesetOptions.form_id,\n      metadata: changesetOptions.metadata || {\n        app: 'fulcrum-js',\n        operation: 'serial_batch_update'\n      }\n    };\n\n    const changeset = await this.client.changesets.create(changesetObj);\n\n    // Update each record with the changeset_id\n    const updatedRecords = [];\n    \n    for (const id of ids) {\n      const recordAttributes = {\n        ...attributes,\n        changeset_id: changeset.id\n      };\n      \n      const options = {\n        body: this.attributesForObject(recordAttributes)\n      };\n\n      const body = await this.client.api.put(this.memberPath(id), options);\n      updatedRecords.push(body[this.resourceName]);\n    }\n\n    // Close the changeset\n    await this.client.changesets.close(changeset.id);\n\n    return updatedRecords;\n  }\n}\n"]}